sap.ui.define(["sap/fe/core/PageController","sap/ui/model/json/JSONModel"],function(e,t){"use strict";let o;return e.extend("adjustmentflow.ext.view.AdjustmentCashFlow",{onInit:function(){e.prototype.onInit.apply(this,arguments);this.getAppComponent().getRouter().attachRouteMatched(this._onObjectMatched,this)},_onObjectMatched:async function(e){debugger;const a=window.location.href;const n=a.match(/ID=([0-9a-fA-F-]+)/);o=null;if(n){o=n[1]}console.log("Contract ID:",o);let l=this.getModel().bindContext("/getcontractDetails(...)");l.setParameter("contractId",o);var s=await l.execute();var r=l.getBoundContext().getValue();var c=r.fixedFrom;var i=r.fixedUntil;function d(e){if(!e)return"";const t=e.split("-");return t[1]+"/"+t[2]+"/"+t[0]}var u=d(c);var p=d(i);var g=new sap.ui.model.json.JSONModel({startFromOld:u,EndFromOld:p});debugger;this.setModel(g,"OldfixedDates");var m=sap.ui.getCore().getModel("NewStartEnd");this.setModel(m,"NewfixedDates");var w=sap.ui.getCore().getModel("OldTable");var f=w.getData().rows;var h=f;const b=f.reduce((e,t)=>{const o=t.name;const a=parseFloat(t.amount)||0;if(!e[o]){e[o]=0}e[o]+=a;return e},{});Object.keys(b).forEach(e=>{b[e]=parseFloat(b[e].toFixed(2))});console.log(b);this.setModel(new t(b),"OldTableTotals");var w=sap.ui.getCore().getModel("NewTable");var f=w.getData().rows;var T=f;console.log("New Table",f);debugger;function M(e,t){e=Array.isArray(e)?e.filter(e=>e.flowType):[];t=Array.isArray(t)?t.filter(e=>e.flowType):[];const o=e=>{const[t,,o]=e.dueDate.split("/");return`${t}/${o}_${e.flowType}`};const a=new Set([...e.map(o),...t.map(o)]);const n=new Map(e.map(e=>[o(e),e]));const l=new Map(t.map(e=>[o(e),e]));const s=(e,t)=>{const o=[];a.forEach(a=>{if(e.has(a)){o.push(e.get(a))}else{const[e,n]=a.split("_");const[l,s]=e.split("/");o.push({dueDate:`${l}/01/${s}`,flowType:n,name:t.get(a)?.name||"",amount:0})}});return o};const r=s(n,l);const c=s(l,n);const i=(e,t)=>{const[o,,a]=e.dueDate.split("/").map(Number);const[n,,l]=t.dueDate.split("/").map(Number);if(a!==l)return a-l;if(o!==n)return o-n;return e.flowType.localeCompare(t.flowType)};r.sort(i);c.sort(i);console.log("âœ… Aligned lengths",r.length,c.length);return{oldData:r,newData:c}}const{oldData:v,newData:y}=M(h,T);console.log("Old Table",v);console.log("New Table",y);this.setModel(new t({rows:v}),"OldTableAdjustScreen");this.setModel(new t({rows:y}),"NewTableAdjustScreen");const A=f.reduce((e,t)=>{const o=t.name;const a=parseFloat(t.amount)||0;if(!e[o]){e[o]=0}e[o]+=a;return e},{});Object.keys(A).forEach(e=>{A[e]=parseFloat(A[e].toFixed(2))});console.log(A);this.setModel(new t(A),"NewTableTotals")},onPostAdjustment:async function(e){debugger;let t=this.getModel("OldTableTotals").getData();let a=this.getModel("NewTableTotals").getData();let n=t["Interest Receivable"]||0;let l=a["Interest Receivable"]||0;let s=0;console.log("totalActInterest",n);console.log("totalAdjInterest",l);if(n||l){s=l-n}s=s.toFixed(2);console.log("calculatedInterest",s);let r=t["Principal Receivable"]||0;let c=a["Principal Receivable"]||0;let i=0;console.log("totalActPrincipal",r);console.log("totalAdjPrincipal",c);if(r||c){i=c-r}i=i.toFixed(2);console.log("calculatedPrincipal",i);let d=this.getModel().bindContext("/postAdjustment(...)");d.setParameter("contractId",o);d.setParameter("interest",s);d.setParameter("principal",i);await d.execute();sap.m.MessageToast.show("Adjustment done:\n"+"Interest: "+s+"\n"+"Principal: "+i,{duration:4e3,width:"20em",my:"center bottom",at:"center bottom"})}})});
//# sourceMappingURL=AdjustmentCashFlow.controller.js.map