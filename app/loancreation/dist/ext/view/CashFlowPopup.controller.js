sap.ui.define(["sap/fe/core/PageController","sap/ui/export/Spreadsheet"],function(e,t){"use strict";return e.extend("loancreation.ext.view.CashFlowPopup",{onInit:function(){e.prototype.onInit.apply(this,arguments);e.prototype.onInit.apply(this,arguments);var t=this.getAppComponent().getRouter();t.getRoute("LoanAmortizationNewCashFlowPopupPage").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){debugger;var t=e.mParameters.arguments.key;function o(e){const t={};const o=/(\w+)=('.*?'|[^,]+)/g;let a;while((a=o.exec(e))!==null){let e=a[1];let o=a[2];if(o.startsWith("'")&&o.endsWith("'")){o=o.slice(1,-1)}try{o=decodeURIComponent(decodeURIComponent(o))}catch(e){try{o=decodeURIComponent(o)}catch{}}t[e]=o}return t}var t=e.getParameter("arguments").key;var a=o(t);var r=a.ID;var n=new sap.ui.model.json.JSONModel(a);this.getView().setModel(n,"keyData");let s=this.getView().byId("ConditionTablepopscreen");var l=s.getBinding("rows");if(l){var p=new sap.ui.model.Filter("contractId",sap.ui.model.FilterOperator.EQ,r);var i=new sap.ui.model.Sorter("index",false);l.sort(i);l.filter([p]);l.refresh()}s.getModel().refresh(true)},onExportToExcel:async function(){debugger;const e=this.byId("ConditionTablepopscreen");const o=e.getBinding("rows");if(!o){sap.m.MessageToast.show("Table binding not found.");return}try{const e=await o.requestContexts(0,Infinity);if(!e.length){sap.m.MessageToast.show("No data available to export.");return}const a=e.map(e=>e.getObject());const r=[{label:"Due Date",property:"dueDate"},{label:"Flow Type",property:"flowType"},{label:"Name",property:"name"},{label:"Plan/Actual Rec",property:"planActualRec"},{label:"Settlement Amount",property:"settlementAmount"},{label:"Base Amount",property:"baseAmount"},{label:"Percentage Rate",property:"percentageRate"},{label:"Calculation From",property:"calculationFrom"},{label:"Calculation Date",property:"calculationDate"},{label:"Number of Days",property:"numberOfDays"}];const n={workbook:{columns:r},dataSource:a,fileName:"CashFlow_Export.xlsx"};const s=new t(n);await s.build();sap.m.MessageToast.show("Export completed successfully.");s.destroy()}catch(e){console.error("Export error:",e);sap.m.MessageToast.show("Error while exporting data.")}}})});
//# sourceMappingURL=CashFlowPopup.controller.js.map