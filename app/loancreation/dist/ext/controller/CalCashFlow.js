sap.ui.define(["sap/m/MessageToast"],function(t){"use strict";return{onCalCashFlow:async function(t){debugger;async function e(){function t(){const t=window.location.href;const e=t.match(/contractNew\(([^)]+)\)/);if(!e)return false;const n=e[1];const a=/(\w+)=('[^']*'|[^,]+)/g;let i={};let r;while((r=a.exec(n))!==null){const t=r[1];const e=r[2];i[t]=e.startsWith("'")&&e.endsWith("'")?e.slice(1,-1):e}return i.IsActiveEntity==="true"}function e(t){const e=t.getContent()[0].getSections()[2].getSubSections()[3].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.content.mAggregations._content.getRows();const n={interestPeriods:[],repaymentChanges:[],finalRepaymentDate:null};e.forEach(t=>{if(t.getBindingContext()){const e=t.getBindingContext().getObject();switch(e.conditionTypeText){case"Nominal Interest Fixed":n.interestPeriods.push({start:a(e.effectiveFrom),rate:parseFloat(e.percentage)||0});break;case"Annuity repayment":n.repaymentChanges.push({start:a(e.effectiveFrom),amount:parseFloat(e.conditionAmt)||0});break;case"Final Repayment":n.finalRepaymentDate=a(e.effectiveFrom);break}}});return n}let n=e(this._view);console.log(n);function a(t){if(!t)return null;const e=new Date(t);if(isNaN(e.getTime()))return null;const n=String(e.getDate()).padStart(2,"0");const a=String(e.getMonth()+1).padStart(2,"0");const i=e.getFullYear();return`${n}/${a}/${i}`}let i=this._view.getContent()[0].getBindingContext().getObject();var r=t();let o=this._view.getModel().bindContext("/loadAmortizationFuncNew(...)");o.setParameter("principal",String(i.commitCapital));o.setParameter("annualRate","0.04");o.setParameter("startDate",String(i.fixedFrom));o.setParameter("endDate",String(i.fixedUntil));o.setParameter("inclusiveIndicator",String(i.include));o.setParameter("contractId",String(i.ID));o.setParameter("intCalMt",String(i.intCalMt)),o.setParameter("isActiveEntity",r),await o.execute()}await e.call(this);function n(){const t=window.location.href;const e=t.match(/contractNew\((.*)\)/);var n=sap.ui.getCore().byId("loancreation::contractNewObjectPage--fe::ObjectPage-OPHeaderContent").mAggregations.content[0].mAggregations.items[0].mAggregations.items[0].mAggregations.items[1].mAggregations.formContainers[0].mAggregations.formElements[2].getFields()[0].getText();var a=sap.ui.getCore().byId("loancreation::contractNewObjectPage--fe::ObjectPage-OPHeaderContent").mAggregations.content[0].mAggregations.items[0].mAggregations.items[0].mAggregations.items[1].mAggregations.formContainers[0].mAggregations.formElements[3].getFields()[0].getText();if(e){let t=e[1];t+=`,status='${n}',disbursementStatus='${a}'`;return t}return null}let a=n();if(a){this.getRouting().navigateToRoute("LoanAmortizationNewCashFlowPopupPage",{key:a})}},onDialogAfterOpen:function(t){debugger;var e=t.getSource().getContent()[0].getSections()[1].getSubSections()[0].getBlocks()[0];var n=e.getBinding("rows");if(n){var a=new sap.ui.model.Sorter("index",false);n.sort(a)}e.getModel().refresh(true)},onClosePress:function(t){debugger;let e=t.getSource().getParent();e.close()}}});
//# sourceMappingURL=CalCashFlow.js.map